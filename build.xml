<?xml version="1.0" encoding="utf-8"?>
<project name="OmeroPy" default="install" basedir=".">
<!--
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
# $Id$
#
# Copyright 2007 Glencoe Software, Inc. All rights reserved.
# Use is subject to license terms supplied in LICENSE.txt
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Written by:  Josh Moore, josh at glencoesoftware.com
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

-->
    <description>
        Python bindings for the blitz server.
    </description>

    <dirname property="up-two"        file="${basedir}"/>
    <dirname property="up-one"        file="${up-two}"/>
    <property name="import.dir"       value="${up-one}/antlib/resources"/>
    <property name="copy.dir"         value="target"/>
    <property name="uses.ice"         value="true"/>

    <import file="${import.dir}/global.xml"/>
    <import file="../python.xml"/>
    <import file="../common.xml"/>

    <target name="tools-init" unless="env.NOPYTHON">
        <get-source todir="${copy.dir}">
            <fileset dir="../../blitz/src" includes="**/*.py"/>
            <fileset dir="../../blitz/target/generated/src" includes="**/*.py">
                <present present="srconly" targetdir="src"/>
            </fileset>
        </get-source>
        <copy todir="${copy.dir}">
            <fileset dir="src" includes="**/*.py"/>
        </copy>
        <slice_py todir="${copy.dir}" prefix="omero_">
            <fileset dir="${copy.dir}/omero" includes="*.ice">
                <depend targetdir="${copy.dir}">
                    <mapper type="regexp" from="^(.*?)[.]ice$$" to="omero_\1_ice.py"/>
                </depend>
            </fileset>
        </slice_py>
        <slice_py todir="${copy.dir}" prefix="omero_model_">
            <fileset dir="${copy.dir}/omero/model/" includes="*.ice">
                <depend targetdir="${copy.dir}">
                    <mapper type="regexp" from="^(.*?)[.]ice$$" to="omero_model_\1_ice.py"/>
                </depend>
            </fileset>
        </slice_py>
    </target>

    <!-- Copied prefs.class for testing the prefs plugin. -->
    <target name="tools-build" depends="tools-init,python-build" description="Uses setup.py to build artifacts" unless="env.NOPYTHON">
        <copy file="${basedir}/bin/omero" tofile="${basedir}/build/bin/omero"/>
        <chmod file="${basedir}/build/bin/omero" perm="ugo+x"/>
        <copy file="${basedir}/../../common/target/classes/prefs.class" todir="${basedir}/build/"/>
    </target>

    <target name="tools-test" depends="tools-build,python-test" description="Runs test target of setup.py" unless="env.NOPYTHON"/>

    <target name="tools-dist" depends="tools-build,python-install" description="Copies files into tools/target" unless="env.NOPYTHON">
    </target>

   <target name="tools-clean" depends="python-clean">
        <delete dir="${copy.dir}"/>
    </target>

</project>
